{% extends 'base.html' %}

{% block title %}Orders - MediCart{% endblock %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
    <h1>All Orders</h1>
    <a href="{% url 'order_place' %}" class="btn btn-success">Place New Order</a>
</div>

<!-- Filter by Status -->
<div style="margin-bottom: 20px;">
    <label for="status-filter" style="margin-right: 10px;">Filter by Status:</label>
    <select id="status-filter" onchange="window.location.href='?status=' + this.value" style="padding: 8px; border-radius: 5px;">
        <option value="">All Orders</option>
        {% for status_key, status_label in status_choices %}
            <option value="{{ status_key }}" {% if current_status == status_key %}selected{% endif %}>{{ status_label }}</option>
        {% endfor %}
    </select>
</div>

{% if orders %}
<table>
    <thead>
        <tr>
            <th>Order ID</th>
            <th>Customer Name</th>
            <th>Medicine</th>
            <th>Quantity</th>
            <th>Total Price</th>
            <th>Order Date</th>
            <th>Status</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for order in orders %}
        <tr>
            <td><strong>#{{ order.id }}</strong></td>
            <td>{{ order.customer_name }}</td>
            <td>{{ order.medicine.name }}</td>
            <td>{{ order.quantity }}</td>
            <td>${{ order.total_price }}</td>
            <td>{{ order.order_date|date:"M d, Y H:i" }}</td>
            <td>
                {% if order.status == 'Pending' %}
                    <span class="badge badge-warning">{{ order.status }}</span>
                {% elif order.status == 'Processing' %}
                    <span class="badge badge-info">{{ order.status }}</span>
                {% elif order.status == 'Shipped' %}
                    <span class="badge badge-info">{{ order.status }}</span>
                {% elif order.status == 'Delivered' %}
                    <span class="badge badge-success">{{ order.status }}</span>
                {% elif order.status == 'Cancelled' %}
                    <span class="badge badge-danger">{{ order.status }}</span>
                {% else %}
                    <span class="badge badge-secondary">{{ order.status }}</span>
                {% endif %}
            </td>
            <td>
                <div class="action-buttons">
                    <a href="{% url 'order_detail' order.id %}" class="btn btn-secondary">View</a>
                    <a href="{% url 'order_update_status' order.id %}" class="btn">Update Status</a>
                </div>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- Pagination -->
{% if orders.has_other_pages %}
<div class="pagination">
    {% if orders.has_previous %}
        <a href="?page=1{% if current_status %}&status={{ current_status }}{% endif %}">First</a>
        <a href="?page={{ orders.previous_page_number }}{% if current_status %}&status={{ current_status }}{% endif %}">Previous</a>
    {% endif %}
    
    <span class="current">Page {{ orders.number }} of {{ orders.paginator.num_pages }}</span>
    
    {% if orders.has_next %}
        <a href="?page={{ orders.next_page_number }}{% if current_status %}&status={{ current_status }}{% endif %}">Next</a>
        <a href="?page={{ orders.paginator.num_pages }}{% if current_status %}&status={{ current_status }}{% endif %}">Last</a>
    {% endif %}
</div>
{% endif %}

{% else %}
<div class="card">
    <p style="text-align: center; font-size: 18px;">No orders found. <a href="{% url 'order_place' %}">Place your first order</a></p>
</div>
{% endif %}
{% endblock %}

